<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-cscf/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-cscf%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-CSCF%5D%20Modified%20Invite%20coming%20back%20from%20TAS%20not%0A%20recognized%20as%20different%20%28Call%20Forwarding%20on%20Busy%29&In-Reply-To=%3C48C1538C.6090007%40fokus.fraunhofer.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001475.html">
   <LINK REL="Next"  HREF="001486.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)</H1>
    <B>Dragos Vingarzan</B> 
    <A HREF="mailto:openimscore-cscf%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-CSCF%5D%20Modified%20Invite%20coming%20back%20from%20TAS%20not%0A%20recognized%20as%20different%20%28Call%20Forwarding%20on%20Busy%29&In-Reply-To=%3C48C1538C.6090007%40fokus.fraunhofer.de%3E"
       TITLE="[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)">Dragos.Vingarzan at fokus.fraunhofer.de
       </A><BR>
    <I>Fri Sep  5 17:43:08 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001475.html">[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)
</A></li>
        <LI>Next message: <A HREF="001486.html">[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1481">[ date ]</a>
              <a href="thread.html#1481">[ thread ]</a>
              <a href="subject.html#1481">[ subject ]</a>
              <a href="author.html#1481">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dick,

I think that there's a misunderstanding in the middle.

The feature that Enrique was talking about is another feature than what
seems to be your issue. The original Request-URI is saved inside the ISC
mark and can be retrieved and checked. This is useful in cases when in
terminating side triggering the target of the INVITE has been changed
and triggering must be applied for the new terminating user.

I was trying to understand your trace and to identify why the new invite
was skipped as a retransmission, but there are some problems with IP
fragmentation plus the fact that it ends quite abruptly. Could you maybe
recapture it? What happens after package 74?

Cheers,
-Dragos

Dick Gooris wrote:
&gt;<i> Enrique,
</I>&gt;<i>
</I>&gt;<i> Have you been able to add the functionality as you suggested. In case 
</I>&gt;<i> you want us to test the new functionality (e.g. as a separate non 
</I>&gt;<i> official patch), then let me know.
</I>&gt;<i>
</I>&gt;<i> Many thanks in advance and kind regards,
</I>&gt;<i>
</I>&gt;<i>     - Dick Gooris
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> - then this 486 goes back, via the S-CSCF to the TAS
</I>&gt;&gt;<i> - and this TAS sends basically the same Invite back again, but now with
</I>&gt;&gt;<i> the R-URI of subscriber 2695, and a 181 back to the originating party to
</I>&gt;&gt;<i> indicate call forwarding is ongoing.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> I'm trying to make a patch to solve this. Scscf should detect that RURI
</I>&gt;<i> in a INVITE Request back from an AS (ISC dialog) has changed and then
</I>&gt;<i> re-send this INVITE Request to the new destination (without checking if
</I>&gt;<i> the new RURI is registered or so on...and acting almost as a new call).
</I>&gt;<i>
</I>&gt;<i> This is the thread in the list (subjetc is a little bit confussing):
</I>&gt;<i> <A HREF="http://lists.berlios.de/pipermail/openimscore-cscf/2008-March/001697.html">http://lists.berlios.de/pipermail/openimscore-cscf/2008-March/001697.html</A>
</I>&gt;<i>
</I>&gt;<i> and what I try to implement is the redirection showed in  the book &quot;3G
</I>&gt;<i> IP Multimedia Subsystem IMS&quot; with OpenIMScore. In chapter 5.8.
</I>&gt;<i> &quot;Application Servers: providing services to users&quot; there is &quot;An example
</I>&gt;<i> of service execution&quot;.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Enrique
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> From: Dick Gooris &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">gooris at alcatel-lucent.com</A>&gt;
</I>&gt;&gt;<i> Date: Fri, 25 Jul 2008 15:19:41 +0200
</I>&gt;&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">openimscore-cscf at lists.berlios.de</A>
</I>&gt;&gt;<i> CC: &quot;Gooris, D A (Dick Gooris.)&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">gooris at alcatel-lucent.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When attaching a TAS to the OpenImsCore, I have the scenario that a 
</I>&gt;&gt;<i> call gets forwarded due to a Busy number.
</I>&gt;&gt;<i> The Invite that addresses the new number is received by the s-cscf, 
</I>&gt;&gt;<i> but not treated in such way it actually sends it to the
</I>&gt;&gt;<i> alternative subscriber.  The s-cscf log says 'Trans already in 
</I>&gt;&gt;<i> processing... skip', so it apparently cannot distinguish it as a new call.
</I>&gt;&gt;<i> The result is that the call forwarding does not take place.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The Tas is based on a stateless proxy, and therefore does not deal 
</I>&gt;&gt;<i> with any alterations in the call-id's, tags, etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Attached the call-trace for wireshark. This ends with the new Invite.
</I>&gt;&gt;<i>      ( please set your preferences--&gt;protocols--&gt;ip--&gt;reassemble fragmented ip datagrams to OFF )
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Attached a one-page .png diagram of the call scenario illustrating 
</I>&gt;&gt;<i> the issue including addresses, numbers, ifc's etc..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Attached the relevant piece of the s-cscf logfile that ends with the 'skip'.*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *I would assume that the s-cscf can distinguish the new call due to 
</I>&gt;&gt;<i> its new request uri. How should this work ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The software version of OpenIMSCore is of end of April.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks in advance, and kind regards,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        - Dick Gooris
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SIP Request:
</I>&gt;&gt;<i>  method:  &lt;INVITE&gt;
</I>&gt;&gt;<i>  uri:     &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">+31356872695 at ims.xcsl.nl</A>&gt;
</I>&gt;&gt;<i>  version: &lt;SIP/2.0&gt;
</I>&gt;&gt;<i> parse_headers: flags=2
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bK_xtastermunreg&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=2
</I>&gt;&gt;<i> parse_headers: this is the first via
</I>&gt;&gt;<i> After parse_msg...
</I>&gt;&gt;<i> preparing to run routing scripts...
</I>&gt;&gt;<i> parse_headers: flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKadd8.0c576366.0&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> parse_headers: this is the second via
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bK_xtastermreg&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKadd8.fb576366.0&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKadd8.eb576366.0&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bK_xtasorig&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKadd8.db576366.0&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKadd8.bacafe57.0&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> Found param type 232, &lt;branch&gt; = &lt;z9hG4bKdf527765a&gt;; state=6
</I>&gt;&gt;<i> Found param type 235, &lt;rport&gt; = &lt;3060&gt;; state=16
</I>&gt;&gt;<i> end of header reached, state=5
</I>&gt;&gt;<i> parse_headers: Via found, flags=100
</I>&gt;&gt;<i> end of header reached, state=9
</I>&gt;&gt;<i> DEBUG: get_hdr_field: &lt;To&gt; [24]; uri=[sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">2696 at ims.xcsl.nl</A>] 
</I>&gt;&gt;<i> DEBUG: to body [&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">2696 at ims.xcsl.nl</A>&gt;]
</I>&gt;&gt;<i> DEBUG:maxfwd:is_maxfwd_present: value = 9 
</I>&gt;&gt;<i> Calling SELECT 0x819f294 
</I>&gt;&gt;<i> parse_headers: flags=ffffffffffffffff
</I>&gt;&gt;<i> get_hdr_field: cseq &lt;CSeq&gt;: &lt;8&gt; &lt;INVITE&gt;
</I>&gt;&gt;<i> DEBUG: get_hdr_body : content_length=176
</I>&gt;&gt;<i> found end of header
</I>&gt;&gt;<i> DEBUG: t_check: msg id=19 global id=18 T start=0xffffffff
</I>&gt;&gt;<i> parse_headers: flags=ffffffffffffffff
</I>&gt;&gt;<i> DEBUG: add_param: tag=xg924c591e
</I>&gt;&gt;<i> end of header reached, state=29
</I>&gt;&gt;<i> parse_headers: flags=78
</I>&gt;&gt;<i> t_lookup_request: start searching: hash=36314, isACK=0
</I>&gt;&gt;<i> DEBUG: RFC3261 transaction matched, tid=_xtastermunreg
</I>&gt;&gt;<i> DEBUG: t_lookup_request: transaction found (T=0xb5d2751c)
</I>&gt;&gt;<i> DEBUG: t_check: msg id=19 global id=19 T end=0xb5d2751c
</I>&gt;&gt;<i> Trans already in processing... skip                        &lt;&lt;&lt;===------  
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> DEBUG:destroy_avp_list: destroying list (nil)
</I>&gt;&gt;<i> receive_msg: cleaning up
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> OpenIMSCore-CSCF mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">OpenIMSCore-CSCF at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">https://lists.berlios.de/mailman/listinfo/openimscore-cscf</A>
</I>&gt;<i>
</I>&gt;<i>   
</I>

-- 
-----------------------------------------
Dipl. Eng. Dragos Vingarzan
Fraunhofer FOKUS/NGNI
Kaiserin-Augusta-Allee 31
10589 Berlin,Germany
Phone +49 (0)30 - 3463 - 7385
Mobile +49 (0)176 - 48 32 16 00
Web www.fokus.fraunhofer.de www.openimscore.org
We could change the world if God would give us the source code...
-----------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001475.html">[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)
</A></li>
	<LI>Next message: <A HREF="001486.html">[OpenIMSCore-CSCF] Modified Invite coming back from TAS not recognized as different (Call Forwarding on Busy)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1481">[ date ]</a>
              <a href="thread.html#1481">[ thread ]</a>
              <a href="subject.html#1481">[ subject ]</a>
              <a href="author.html#1481">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-cscf">More information about the OpenIMSCore-CSCF
mailing list</a><br>
</body></html>
